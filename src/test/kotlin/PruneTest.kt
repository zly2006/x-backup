
import com.github.zly2006.xbackup.Config
import kotlinx.serialization.json.Json
import org.junit.Test
import kotlin.test.assertEquals

class PruneTest {
    val data = Json.decodeFromString<Map<String, Long>>("""{"477":1732980378752,"476":1732975793207,"475":1732964978891,"474":1732959538504,"473":1732958792246,"472":1732955180627,"471":1732951571916,"470":1732949984472,"469":1732946373493,"468":1732942761786,"467":1732939145428,"466":1732935534950,"465":1732931924113,"464":1732928313344,"463":1732924702944,"462":1732921092271,"461":1732917480666,"460":1732913868288,"459":1732910253149,"458":1732906640802,"457":1732903033484,"456":1732900691504,"455":1732897950326,"454":1732894517282,"453":1732890904153,"452":1732888481048,"451":1732884859070,"450":1732881252615,"449":1732877644141,"448":1732874033020,"447":1732870422890,"446":1732866816712,"445":1732863206612,"444":1732859596702,"443":1732855989211,"442":1732852378120,"441":1732848767240,"440":1732845159706,"439":1732841549079,"438":1732837939032,"437":1732834331339,"436":1732830721075,"435":1732827111168,"434":1732823494949,"433":1732819883363,"432":1732816271163,"431":1732812659184,"430":1732809046230,"429":1732805434543,"428":1732801826642,"427":1732798215250,"426":1732794605245,"425":1732790988084,"424":1732787378579,"423":1732783768512,"422":1732780152581,"421":1732776542599,"420":1732772932626,"419":1732769322178,"418":1732765711616,"417":1732762103486,"416":1732758493669,"415":1732754884424,"414":1732751274827,"413":1732747665218,"412":1732744056122,"411":1732740446354,"410":1732736836722,"409":1732733225942,"408":1732729616165,"407":1732726005089,"406":1732722395944,"405":1732718785405,"404":1732715169086,"403":1732714763508,"402":1732714666585,"401":1732714235333,"400":1732710620513,"399":1732707004556,"398":1732703395073,"397":1732699785265,"396":1732696171987,"395":1732692545952,"394":1732688935913,"393":1732685319860,"392":1732681709088,"391":1732678098541,"390":1732674491209,"389":1732670881749,"388":1732667272058,"387":1732663657837,"386":1732660047759,"385":1732656437986,"384":1732652822869,"383":1732649213364,"382":1732645603239,"381":1732641987352,"380":1732638376561,"379":1732634766733,"378":1732631151484,"377":1732627541262,"376":1732623931126,"375":1732620315920,"374":1732616706805,"373":1732613097161,"372":1732609487154,"371":1732605877246,"370":1732602268346,"369":1732598657821,"368":1732595048054,"367":1732591437957,"366":1732587827935,"365":1732584219171,"364":1732580609549,"363":1732577000148,"362":1732573391704,"361":1732569782075,"360":1732566172755,"359":1732562563795,"358":1732558952780,"357":1732555342016,"356":1732551732012,"355":1732548122385,"354":1732544513341,"353":1732540902949,"352":1732537289428,"351":1732533672663,"350":1732530062404,"349":1732526449947,"348":1732522843042,"347":1732522226787,"346":1732521644697,"345":1732521315694,"344":1732521184054,"343":1732517575579,"342":1732513966588,"341":1732510357558,"340":1732506748713,"339":1732503139702,"338":1732499530807,"337":1732495918980,"336":1732492304330,"335":1732489768330,"334":1732488674083,"333":1732485065205,"332":1732481455769,"331":1732477847623,"330":1732474239463,"329":1732470623429,"328":1732467007565,"327":1732461047122,"326":1732457437747,"325":1732453827812,"324":1732450217139,"323":1732446602346,"322":1732442992830,"321":1732439383262,"320":1732435773589,"319":1732432164041,"318":1732428556609,"317":1732424934143,"316":1732424231032,"315":1732420742236,"314":1732417131721,"313":1732413522060,"312":1732409912446,"311":1732406302881,"310":1732402693267,"309":1732399084134,"308":1732395475162,"307":1732391866470,"306":1732388257779,"305":1732384644200,"304":1732381031456,"303":1732381009967,"302":1732379099605,"301":1732376236025,"300":1732376139908,"299":1732375962005,"298":1732375780611,"297":1732374150392,"296":1732373800736,"295":1732373080905,"294":1732372408595,"293":1732370541715,"292":1732366928398,"291":1732363317708,"290":1732359707037,"289":1732356096701,"288":1732352486809,"287":1732348876291,"286":1732345265360,"285":1732341654885,"284":1732338044560,"283":1732334432974,"282":1732330823921,"281":1732327215491,"280":1732323607078,"279":1732319998331,"278":1732316390176,"277":1732312780940,"276":1732309172283,"275":1732305563467,"274":1732301953934,"273":1732298344861,"272":1732294733006,"271":1732291124210,"270":1732287514619,"269":1732283906447,"267":1732276686989,"266":1732275413965,"265":1732271805081,"264":1732268194130,"263":1732264579423,"262":1732260962246,"261":1732257353219,"260":1732253742535,"259":1732250132249,"258":1732246521607,"257":1732242912455,"256":1732239303424,"255":1732235693129,"254":1732232084163,"253":1732228475044,"252":1732224866436,"251":1732221257997,"250":1732217648422,"249":1732214040085,"248":1732210431820,"247":1732206823125,"246":1732203213566,"245":1732199606413,"244":1732199002058,"243":1732198996015,"242":1732198328638,"241":1732194719114,"240":1732191110704,"239":1732187502159,"238":1732183893161,"237":1732180283897,"236":1732176673457,"235":1732173064287,"234":1732169455362,"233":1732165846142,"232":1732162237099,"231":1732158628745,"230":1732155020280,"229":1732151410096,"228":1732147800740,"227":1732144190846,"226":1732140581366,"225":1732136973390,"224":1732133365129,"223":1732129757123,"222":1732126148930,"221":1732122539481,"220":1732118930219,"219":1732115321715,"218":1732111709346,"217":1732108100001,"216":1732104488684,"215":1732100880265,"214":1732097272250,"213":1732093661499,"212":1732090053412,"211":1732086443636,"210":1732082835605,"209":1732079186724,"208":1732075577863,"207":1732071969053,"206":1732068360623,"205":1732064752230,"204":1732061143453,"203":1732057537038,"202":1732053929806,"201":1732050323323,"200":1732046716635,"199":1732043108818,"198":1732039501768,"197":1732035894469,"196":1732032287753,"195":1732028680310,"194":1732025071402,"193":1732021462953,"192":1732017853510,"191":1732014242523,"190":1732010630363,"189":1732007019565,"188":1732003409742,"187":1731999798749,"186":1731996188095,"185":1731992576648,"184":1731988967836,"183":1731985361014,"182":1731981753874,"181":1731978146217,"180":1731974538839,"179":1731970931117,"178":1731967320019,"177":1731963709141,"176":1731960097778,"175":1731956487333,"174":1731952876350,"173":1731949266077,"172":1731945653640,"171":1731942041580,"170":1731938430371,"169":1731934818828,"168":1731931209387,"167":1731927598273,"166":1731923986628,"165":1731920372983,"164":1731916757996,"163":1731913147353,"162":1731909538269,"161":1731905925951,"160":1731859497911,"159":1731855889438,"158":1731852281457,"157":1731848674368,"156":1731845066377,"155":1731841450420,"154":1731837843979,"153":1731834236741,"152":1731830629712,"151":1731827022641,"150":1731823415773,"149":1731819805963,"148":1731816197813,"147":1731813717793,"146":1731813613509,"145":1731812832906,"144":1731812169845,"143":1731811868203,"142":1731811443430,"141":1731810577262,"140":1731807836343,"139":1731804883468,"138":1731804877521,"137":1731802253271,"136":1731798646679,"135":1731795041043,"134":1731791433563,"133":1731787826070,"132":1731784214882,"131":1731780598710,"130":1731778150600,"129":1731774539115,"128":1731770927308,"127":1731767309014,"126":1731764576455,"125":1731762192765,"124":1731761398715,"123":1731760218206,"122":1731758243005,"121":1731757283523,"120":1731755644532,"119":1731753824195,"118":1731750216367,"117":1731747559075,"116":1731746977456,"115":1731746037984,"114":1731742669161,"113":1731739823278,"112":1731736212384,"111":1731735792282,"110":1731732183766,"109":1731728569664,"108":1731726545219,"107":1731723285842,"106":1731719677705,"105":1731694682076,"104":1731693848335,"103":1731691674738,"102":1731690462408,"101":1731690429161,"100":1731690424357,"99":1731690418942,"98":1731690169586,"97":1731688701906,"96":1731688500523,"95":1731688066386,"94":1731687763964,"93":1731687346844,"92":1731686865992,"91":1731686314544,"90":1731685068046,"89":1731684650599,"88":1731683885012,"87":1731683620739,"86":1731683264801,"85":1731682932790,"84":1731682583166,"83":1731682387590,"82":1731682088842,"81":1731681888990,"80":1731681598740,"79":1731681305491,"78":1731680744769,"77":1731680062310,"76":1731679713502,"75":1731679380394,"74":1731678326596,"73":1731677851850,"72":1731676463342,"71":1731675861638,"70":1731675849576,"69":1731675662663,"68":1731675403890,"67":1731675064737,"66":1731674938485,"65":1731674578939,"64":1731674350465,"63":1731673827899,"62":1731673619190,"61":1731672903182,"60":1731672449279,"59":1731671808077,"58":1731670233882,"57":1731668719453,"56":1731665114529,"55":1731661509280,"54":1731657903560,"53":1731654295093,"52":1731654017724,"51":1731653895338,"50":1731653494934,"49":1731653460431,"48":1731600348287,"47":1731596728914,"46":1731593118234,"45":1731589506271,"44":1731585887415,"43":1731582270656,"42":1731578650978,"41":1731575038794,"40":1731571419866,"39":1731567802074,"38":1731564192509,"37":1731560575150,"36":1731556956103,"35":1731553337381,"34":1731549720046,"33":1731546101082,"32":1731542484990,"31":1731538866689,"30":1731535247703,"29":1731531627225,"28":1731528009197,"27":1731524390373,"26":1731520772201,"25":1731517152913,"24":1731513534459,"23":1731509924606,"22":1731506306647,"21":1731502693272,"20":1731499082791,"19":1731498079733,"18":1731494460962,"17":1731490843259,"16":1731486491703,"15":1731482868425,"14":1731479249602,"13":1731475632688,"12":1731472016734,"11":1731469553323,"10":1731465910403,"9":1731436275046,"8":1731432654856,"7":1731429038620,"6":1731420215324,"5":1731417742075,"4":1731414126287,"3":1731413156936,"2":1731409538518,"1":1731379550278}""")

    @Test
    fun test() {
        assertEquals(431, Config.PruneConfig().apply {
            enabled = true
        }.prune(data, 1733025063000).size)
        val prune = Config.PruneConfig().apply {
            enabled = true
        }.prune(data, 1733025063000)
        data.toMutableMap().also {
            prune.forEach { id -> it.remove(id) }
        }.let {
            println(it)
        }
    }
}
